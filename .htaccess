RewriteEngine On
RewriteBase /techzen/
Options -MultiViews

# Exclude admin directory
RewriteRule ^admin/ - [L]

# Block access to sensitive files
<FilesMatch "^(secrets\.php|composer\.(json|lock)|\.htaccess)">
    Require all denied
</FilesMatch>

# Redirect .php to non-.php (Canonical URLs)
# Only redirect if it's not a POST request
RewriteCond %{REQUEST_METHOD} !POST
# Match .php in the original request
RewriteCond %{THE_REQUEST} \s/+(.*)\.php[\s?] [NC]
# Exclude admin directory from this check explicitly just in case
RewriteCond %{REQUEST_URI} !^/admin/
RewriteRule ^ %1 [R=301,L]

# Custom Routes for Details Pages (SEO Friendly)
# Exclude real files/directories
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^blog/([^/]+)$ blog-single.php?slug=$1 [L,QSA]

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^service/([^/]+)$ service-details.php?slug=$1 [L,QSA]

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^project/([^/]+)$ project-details.php?slug=$1 [L,QSA]

# Internally map clean URL to .php (Generic for about, contact, etc)
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^([^\.]+)$ $1.php [NC,L]
